{% extends "base.html" %}
{% block content %}
 <h3 class="teal-text text-darken-4 center-align text-shadow">Car Maintenance Tracker</h3>
{% if session.user == "admin" %}
    <div class="row">
        <div class="col s12 m6 offset-m3 grey lighten-5">
            <p>As an admin users, you see all records.</p>
        </div>
    </div>      
{% else %}
    <div class="row">
        <div class="col s12 m6 offset-m3 grey lighten-5">
            <p>Only records for cars registered to you are shown.</p>
        </div>
    </div>   
{% endif %}
<div class="row">
    {% for cars in user_cars %}
        <div class="col s12 m6 offset-m3">
            <ul class="collapsible">
                <li>
                    <div class="collapsible-header">
                        <i class="fas fa-chevron-down teal-text text-darken-2"></i>
                        <div class="col m4 s8">
                            <h6>Logs for {{cars.reg_no }}</h6>
                        </div>
                        <div class="col m4 s2">
                            <h6>{{cars.make }}</h6>
                        </div>
                        <div class="col m4 s2">
                            <h6>{{cars.model }}</h6>
                        </div>
                    </div>
                    <div class="collapsible-body">
                        <div class="row m8 offset-m2">
                                                <div class="col s6 m3">
                                                    <h6 class="teal-text text-darken-4">Service Date</h6>
                                                </div>
                                                <div class="col s3 m3">
                                                    <h6 class="teal-text text-darken-4">Cost</h6>
                                                </div>
                                                <div class="col s3 m3">
                                                    <h6 class="teal-text text-darken-4">Invoice</h6>
                                                </div>
                                                <div class="col s3 m3">
                                                </div>
                                                <div class="col s3 m3">
                                                </div>
                                            </div>
                            {% for log in logs %}
                                {% if log.reg_no == cars.reg_no %}
                                            <div class="row m8 offset-m2 grey lighten-3">
                                                <div class="col s6 m3">
                                                    {{ logs[loop.index0].service_date }}
                                                </div>
                                                <div class="col s3 m3">
                                                    â‚¬ {{ logs[loop.index0].service_cost }}
                                                </div>
                                                <div class="col s3 m3">
                                                {% if logs[loop.index0].service_paid == "no" %}
                                                    <span class="red-text">Unpaid</span>
                                                {% else %}
                                                    <span>Paid</span>
                                                {% endif %}
                                                </div>
                                                <div class="col s12 m3 center-align">
                                                    <a href="{{ url_for('detailed_record', record_id=logs[loop.index0]._id) }}" class="btn teal darken-2 tracker_button">Details</a>
                                                </div>
                                            </div>
                                      
                                {% endif %}
                            {% endfor %}
                    </div>
                </li>
            </ul>
        </div>
    {% endfor %}
</div>
{% endblock %}